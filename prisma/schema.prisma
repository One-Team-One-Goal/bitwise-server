generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Lesson {
  id                  Int                 @id @default(autoincrement())
  title               String
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  topics              Topic[]
  userLessons         UserLesson[]
  userLessonMasteries UserLessonMastery[]
}

model Topic {
  id             Int         @id @default(autoincrement())
  title          String
  lessonId       Int
  tags           String[]
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  contentText    String
  displayContent Json?
  lesson         Lesson      @relation(fields: [lessonId], references: [id])
  UserSkill      UserSkill[]
  userTopics     UserTopic[]
}

model UserSkill {
  id                Int      @id @default(autoincrement())
  userId            String
  topicId           Int
  level             Float    @default(0.5)
  mastery           Float    @default(0.5)
  attempts          Int      @default(0)
  correct           Int      @default(0)
  updatedAt         DateTime @updatedAt
  createdAt         DateTime @default(now())
  currentDifficulty String   @default("easy")
  topic             Topic    @relation(fields: [topicId], references: [id])

  @@unique([userId, topicId])
}

model Attempt {
  id          Int      @id @default(autoincrement())
  userId      String
  responses   Json?
  score       Int?
  feedback    String?
  createdAt   DateTime @default(now())
  questions   Json
  updatedAt   DateTime @updatedAt
  performance Json?
}

model UserLesson {
  id           Int       @id @default(autoincrement())
  userId       String
  lessonId     Int
  status       String    @default("not-started")
  progress     Float     @default(0.0)
  masteryScore Float?
  startedAt    DateTime?
  completedAt  DateTime?
  lastViewedAt DateTime  @updatedAt
  createdAt    DateTime  @default(now())
  lesson       Lesson    @relation(fields: [lessonId], references: [id])

  @@unique([userId, lessonId])
  @@index([userId])
}

model UserTopic {
  id            Int       @id @default(autoincrement())
  userId        String
  topicId       Int
  status        String    @default("not-started")
  viewCount     Int       @default(0)
  timeSpent     Int       @default(0)
  firstViewedAt DateTime?
  lastViewedAt  DateTime  @updatedAt
  completedAt   DateTime?
  createdAt     DateTime  @default(now())
  topic         Topic     @relation(fields: [topicId], references: [id])

  @@unique([userId, topicId])
  @@index([userId])
}

model UserLessonMastery {
  id               Int       @id @default(autoincrement())
  userId           String
  lessonId         Int
  masteryScore     Float     @default(0.5)
  assessmentCount  Int       @default(0)
  lastAssessmentAt DateTime?
  updatedAt        DateTime  @updatedAt
  createdAt        DateTime  @default(now())
  lesson           Lesson    @relation(fields: [lessonId], references: [id])

  @@unique([userId, lessonId])
  @@index([userId])
}

model BooleanExample {
  id              String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  title           String
  expression      String   @unique
  description     String
  learningFocus   String
  difficulty      String
  category        String
  variableCount   Int
  lawsUsed        String[]
  tags            String[]
  actualVariables String[]
  sortOrder       Int      @default(0)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now()) @updatedAt

  @@index([difficulty])
  @@index([category])
  @@index([variableCount])
  @@index([isActive])
}
